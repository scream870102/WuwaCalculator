<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é³´æ½®è³‡æºè¨ˆç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
            background: #0a0e27;
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: #151929;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        h1 {
            text-align: center;
            color: #00d4ff;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .header-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 30px;
            background: #1a1f35;
            border-radius: 8px;
            padding: 4px;
        }

        .tab {
            flex: 1;
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #8b92b0;
            transition: all 0.3s;
            border-radius: 6px;
        }

        .tab.active {
            background: #00d4ff;
            color: #0a0e27;
            font-weight: 600;
        }

        .tab:hover:not(.active) {
            background: #252b45;
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group {
            margin-bottom: 20px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #b0b7c3;
            font-weight: 500;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select, input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #2a3150;
            border-radius: 6px;
            font-size: 16px;
            background: #1a1f35;
            color: #e0e0e0;
            transition: all 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #00d4ff;
            background: #252b45;
        }

        .level-selector {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 15px;
            align-items: center;
        }

        .arrow {
            font-size: 24px;
            color: #00d4ff;
        }

        button {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #0a0e27;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 212, 255, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #2a3150;
            color: #e0e0e0;
        }

        .btn-secondary:hover {
            background: #353d5c;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757 0%, #cc3333 100%);
            color: white;
        }

        .btn-danger:hover {
            box-shadow: 0 8px 20px rgba(255, 71, 87, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        .character-info {
            background: #1a1f35;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 3px solid #00d4ff;
        }

        .attribute-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
            text-transform: uppercase;
        }

        .attr-fusion { background: #ff6b6b; color: white; }
        .attr-aero { background: #4ecdc4; color: white; }
        .attr-electro { background: #9b59b6; color: white; }
        .attr-glacio { background: #3498db; color: white; }
        .attr-spectro { background: #f1c40f; color: #0a0e27; }
        .attr-havoc { background: #e74c3c; color: white; }

        .plan-list {
            margin-top: 20px;
        }

        .plan-item {
            background: #1a1f35;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 3px solid #00d4ff;
            position: relative;
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .plan-title {
            font-size: 18px;
            font-weight: 600;
            color: #00d4ff;
        }

        .plan-actions {
            display: flex;
            gap: 10px;
        }

        .plan-actions button {
            padding: 6px 12px;
            font-size: 14px;
        }

        .plan-details {
            color: #b0b7c3;
            font-size: 14px;
            line-height: 1.8;
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            background: #1a1f35;
            border-radius: 6px;
        }

        .material-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #252b45;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .material-item:hover {
            background: #2d3451;
            transform: translateX(5px);
        }

        .material-name {
            font-weight: 600;
            color: #e0e0e0;
            flex: 1;
        }

        .material-count {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .needed {
            color: #ff6b6b;
            font-weight: 600;
        }

        .owned {
            color: #2ecc71;
            font-weight: 600;
        }

        .shortage {
            color: #ff4757;
            background: rgba(255, 71, 87, 0.2);
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .surplus {
            color: #2ecc71;
            background: rgba(46, 204, 113, 0.2);
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .inventory-item {
            background: #1a1f35;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #2a3150;
            transition: all 0.3s;
        }

        .inventory-item:hover {
            border-color: #00d4ff;
            background: #252b45;
        }

        .inventory-item label {
            color: #b0b7c3;
            font-size: 13px;
        }

        .inventory-item input {
            margin-top: 8px;
        }

        .synthesis-info {
            background: rgba(0, 212, 255, 0.1);
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            font-size: 14px;
            color: #00d4ff;
            border-left: 3px solid #00d4ff;
        }

        .section-title {
            font-size: 1.3em;
            color: #00d4ff;
            margin: 30px 0 15px 0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-text {
            color: #b0b7c3;
            font-size: 14px;
            margin-top: 10px;
            padding: 15px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 6px;
            border-left: 3px solid #00d4ff;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8b92b0;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #00d4ff;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #151929;
            padding: 30px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5em;
            color: #00d4ff;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            color: #8b92b0;
            font-size: 28px;
            padding: 0;
            width: 32px;
            height: 32px;
            border-radius: 4px;
        }

        .close-modal:hover {
            background: #2a3150;
            color: #fff;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .inventory-grid {
                grid-template-columns: 1fr;
            }
            
            .material-count {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš”ï¸ é³´æ½®è³‡æºè¨ˆç®—å™¨</h1>
        
        <div class="header-actions">
            <button onclick="refreshData()" class="btn-success">ğŸ”„ æ›´æ–°è§’è‰²è³‡æ–™</button>
            <button onclick="exportData()" class="btn-secondary">ğŸ“¥ åŒ¯å‡ºè³‡æ–™</button>
            <button onclick="importData()" class="btn-secondary">ğŸ“¤ åŒ¯å…¥è³‡æ–™</button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('planner')">ğŸ“‹ å‡ç´šè¨ˆåŠƒ</button>
            <button class="tab" onclick="switchTab('summary')">ğŸ“Š ç¸½è¦½</button>
            <button class="tab" onclick="switchTab('inventory')">ğŸ’ ææ–™åº«å­˜</button>
            <button class="tab" onclick="switchTab('about')">â„¹ï¸ é—œæ–¼</button>
        </div>

        <!-- å‡ç´šè¨ˆåŠƒæ¨™ç±¤ -->
        <div id="planner" class="tab-content active">
            <div class="grid-2">
                <div>
                    <h3 class="section-title">è§’è‰²æŠ€èƒ½å‡ç´š</h3>
                    <div class="input-group">
                        <label>é¸æ“‡è§’è‰²</label>
                        <select id="characterSelect">
                            <option value="">è«‹é¸æ“‡è§’è‰²</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>æŠ€èƒ½é¡å‹</label>
                        <select id="skillType">
                            <option value="normal">æ™®é€šæ”»æ“Š</option>
                            <option value="skill">å…±é³´æŠ€èƒ½</option>
                            <option value="liberation">å…±é³´è§£æ”¾</option>
                            <option value="intro">è®Šå¥æŠ€èƒ½</option>
                            <option value="forte">å»¶å¥æŠ€èƒ½</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>æŠ€èƒ½ç­‰ç´š</label>
                        <div class="level-selector">
                            <select id="currentSkillLevel"></select>
                            <span class="arrow">â†’</span>
                            <select id="targetSkillLevel"></select>
                        </div>
                    </div>

                    <button onclick="addSkillPlan()">â• åŠ å…¥è¨ˆåŠƒ</button>
                </div>

                <div>
                    <h3 class="section-title">æ­¦å™¨å‡ç´š</h3>
                    <div class="input-group">
                        <label>æ­¦å™¨åç¨±ï¼ˆé¸å¡«ï¼‰</label>
                        <input type="text" id="weaponName" placeholder="ä¾‹å¦‚ï¼šæ™‚å’Œæ­²ç¨”">
                    </div>

                    <div class="grid-2">
                        <div class="input-group">
                            <label>æ­¦å™¨ç¨€æœ‰åº¦</label>
                            <select id="weaponRarity">
                                <option value="3">3æ˜Ÿ</option>
                                <option value="4">4æ˜Ÿ</option>
                                <option value="5">5æ˜Ÿ</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label>æ­¦å™¨é¡å‹</label>
                            <select id="weaponType">
                                <option value="sword">é•·åŠ</option>
                                <option value="broadblade">é—Šåˆ€</option>
                                <option value="pistols">éŸ³æ„Ÿå„€</option>
                                <option value="gauntlets">è‡‚é§</option>
                                <option value="rectifier">çŸ©é™£</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>æ­¦å™¨ç­‰ç´š</label>
                        <div class="level-selector">
                            <select id="currentWeaponLevel"></select>
                            <span class="arrow">â†’</span>
                            <select id="targetWeaponLevel"></select>
                        </div>
                    </div>

                    <button onclick="addWeaponPlan()">â• åŠ å…¥è¨ˆåŠƒ</button>
                </div>
            </div>

            <div class="section-title">ç•¶å‰è¨ˆåŠƒåˆ—è¡¨</div>
            <div id="planList" class="plan-list"></div>
        </div>

        <!-- ç¸½è¦½æ¨™ç±¤ -->
        <div id="summary" class="tab-content">
            <div class="action-buttons">
                <button onclick="calculateTotal()">ğŸ§® è¨ˆç®—ç¸½éœ€æ±‚</button>
                <button onclick="clearAllPlans()" class="btn-danger">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰è¨ˆåŠƒ</button>
            </div>
            
            <div id="totalResults" class="results" style="display:none;"></div>
        </div>

        <!-- ææ–™åº«å­˜æ¨™ç±¤ -->
        <div id="inventory" class="tab-content">
            <div class="action-buttons">
                <button onclick="saveInventory()" class="btn-success">ğŸ’¾ ä¿å­˜åº«å­˜</button>
                <button onclick="clearInventory()" class="btn-danger">ğŸ—‘ï¸ æ¸…ç©ºåº«å­˜</button>
            </div>
            
            <p class="info-text">ğŸ’¡ æç¤ºï¼šåœ¨é€™è£¡è¼¸å…¥ä½ æ“æœ‰çš„ææ–™æ•¸é‡ï¼Œè¨ˆç®—æ™‚æœƒè‡ªå‹•å°æ¯”ä¸¦é¡¯ç¤ºç¼ºå°‘çš„ææ–™ä»¥åŠåˆæˆå»ºè­°</p>
            
            <h3 class="section-title">æŠ€èƒ½ææ–™</h3>
            <div class="inventory-grid" id="skillInventoryGrid"></div>
            
            <h3 class="section-title">æ­¦å™¨ææ–™</h3>
            <div class="inventory-grid" id="weaponInventoryGrid"></div>
            
            <h3 class="section-title">é€šç”¨ææ–™</h3>
            <div class="inventory-grid" id="commonInventoryGrid"></div>
        </div>

        <!-- é—œæ–¼æ¨™ç±¤ -->
        <div id="about" class="tab-content">
            <h2 class="section-title">é—œæ–¼æœ¬è¨ˆç®—å™¨</h2>
            <p style="line-height: 1.8; color: #b0b7c3;">
                æœ¬è¨ˆç®—å™¨æ˜¯ç‚ºé³´æ½®ç©å®¶è¨­è¨ˆçš„è³‡æºç®¡ç†å·¥å…·ï¼Œå¹«åŠ©ä½ è¨ˆåŠƒå¤šå€‹è§’è‰²æŠ€èƒ½å’Œæ­¦å™¨çš„å‡ç´šè·¯ç·šï¼Œä¸¦æ™ºèƒ½è¨ˆç®—ææ–™éœ€æ±‚ã€‚
            </p>
            <br>
            <h3 class="section-title">åŠŸèƒ½ç‰¹è‰²</h3>
            <ul style="line-height: 2; color: #b0b7c3; margin-left: 20px;">
                <li>âœ… æ”¯æ´å¤šè§’è‰²ã€å¤šæ­¦å™¨åŒæ™‚è¦åŠƒ</li>
                <li>âœ… æ™ºèƒ½åˆæˆå»ºè­°ï¼Œè‡ªå‹•è¨ˆç®—ä½ç´šææ–™è½‰æ›</li>
                <li>âœ… æœ¬åœ°æ•¸æ“šä¿å­˜ï¼Œä¸æœƒä¸Ÿå¤±</li>
                <li>âœ… è‡ªå‹•æ›´æ–°æœ€æ–°è§’è‰²è³‡æ–™</li>
                <li>âœ… æ·±è‰²æ‰å¹³åŒ–è¨­è¨ˆï¼Œè­·çœ¼èˆ’é©</li>
            </ul>
            <br>
            <h3 class="section-title">ä½¿ç”¨èªªæ˜</h3>
            <ol style="line-height: 2; color: #b0b7c3; margin-left: 20px;">
                <li>å…ˆåœ¨ã€Œææ–™åº«å­˜ã€é é¢è¼¸å…¥ä½ ç¾æœ‰çš„ææ–™æ•¸é‡ä¸¦ä¿å­˜</li>
                <li>åœ¨ã€Œå‡ç´šè¨ˆåŠƒã€é é¢æ·»åŠ è¦å‡ç´šçš„è§’è‰²æŠ€èƒ½æˆ–æ­¦å™¨</li>
                <li>åˆ‡æ›åˆ°ã€Œç¸½è¦½ã€é é¢ï¼Œé»æ“Šè¨ˆç®—ç¸½éœ€æ±‚</li>
                <li>ç³»çµ±æœƒé¡¯ç¤ºæ‰€æœ‰ææ–™éœ€æ±‚ã€ç¼ºå£å’Œåˆæˆå»ºè­°</li>
            </ol>
            <br>
            <p class="info-text">
                <strong>ğŸ“Œ æ³¨æ„ï¼š</strong>è§’è‰²è³‡æ–™æœƒå®šæœŸæ›´æ–°ï¼Œé»æ“Šã€Œæ›´æ–°è§’è‰²è³‡æ–™ã€æŒ‰éˆ•å¯ç²å–æœ€æ–°è³‡è¨Šã€‚ææ–™è¨ˆç®—åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›éœ€æ±‚ä»¥éŠæˆ²å…§ç‚ºæº–ã€‚
            </p>
        </div>
    </div>

    <!-- åŒ¯å…¥è³‡æ–™Modal -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">åŒ¯å…¥è³‡æ–™</h3>
                <button class="close-modal" onclick="closeImportModal()">Ã—</button>
            </div>
            <div class="input-group">
                <label>è²¼ä¸ŠåŒ¯å‡ºçš„JSONè³‡æ–™</label>
                <textarea id="importData" rows="10" style="width: 100%; padding: 12px; background: #1a1f35; border: 1px solid #2a3150; border-radius: 6px; color: #e0e0e0; font-family: monospace;"></textarea>
            </div>
            <div class="action-buttons">
                <button onclick="confirmImport()" class="btn-success">ç¢ºèªåŒ¯å…¥</button>
                <button onclick="closeImportModal()" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // è§’è‰²æ•¸æ“šåº«
        let characters = {
            jiyan: { name: 'å¿Œç‚', attr: 'ç†±ç†”', weapon: 'é—Šåˆ€', rarity: 5 },
            encore: { name: 'å®‰å¯', attr: 'ç†±ç†”', weapon: 'çŸ©é™£', rarity: 5 },
            changli: { name: 'é•·é›¢', attr: 'ç†±ç†”', weapon: 'é•·åŠ', rarity: 5 },
            jianxin: { name: 'é‘’å¿ƒ', attr: 'æ°£å‹•', weapon: 'è‡‚é§', rarity: 5 },
            calcharo: { name: 'å¡å¡ç¾…', attr: 'å°é›»', weapon: 'é—Šåˆ€', rarity: 5 },
            yinlin: { name: 'åŸéœ–', attr: 'å°é›»', weapon: 'çŸ©é™£', rarity: 5 },
            xiangliyao: { name: 'ç›¸é‡Œè¦', attr: 'å°é›»', weapon: 'è‡‚é§', rarity: 5 },
            zhezhi: { name: 'æŠ˜æ', attr: 'å†·å‡', weapon: 'çŸ©é™£', rarity: 5 },
            lingyang: { name: 'å‡Œé™½', attr: 'å†·å‡', weapon: 'è‡‚é§', rarity: 5 },
            verina: { name: 'ç¶­é‡Œå¥ˆ', attr: 'è¡å°„', weapon: 'çŸ©é™£', rarity: 5 },
            shorekeeper: { name: 'å®ˆå²¸äºº', attr: 'è¡å°„', weapon: 'çŸ©é™£', rarity: 5 },
            jinxi: { name: 'ä»Šæ±', attr: 'è¡å°„', weapon: 'é•·åŠ', rarity: 5 },
            'havoc-rover': { name: 'æ¼‚æ³Šè€…Â·æ¹®æ»…', attr: 'æ¹®æ»…', weapon: 'é•·åŠ', rarity: 5 },
            camellya: { name: 'å¡æ¢…è‰é›…', attr: 'æ¹®æ»…', weapon: 'é•·åŠ', rarity: 5 },
            yangyang: { name: 'ç§§ç§§', attr: 'æ°£å‹•', weapon: 'é•·åŠ', rarity: 4 },
            baizhi: { name: 'ç™½èŠ·', attr: 'å†·å‡', weapon: 'çŸ©é™£', rarity: 4 },
            chixia: { name: 'ç†¾éœ', attr: 'ç†±ç†”', weapon: 'éŸ³æ„Ÿå„€', rarity: 4 },
            yuanwu: { name: 'æ·µæ­¦', attr: 'å°é›»', weapon: 'è‡‚é§', rarity: 4 },
            danjin: { name: 'ä¸¹ç‘¾', attr: 'æ¹®æ»…', weapon: 'é•·åŠ', rarity: 4 },
            aalto: { name: 'ç§‹æ°´', attr: 'æ°£å‹•', weapon: 'éŸ³æ„Ÿå„€', rarity: 4 },
            mortefi: { name: 'è«ç‰¹æ–', attr: 'ç†±ç†”', weapon: 'éŸ³æ„Ÿå„€', rarity: 4 },
            taoqi: { name: 'æ¡ƒç¥ˆ', attr: 'æ¹®æ»…', weapon: 'é—Šåˆ€', rarity: 4 },
            sanhua: { name: 'æ•£è¯', attr: 'å†·å‡', weapon: 'é•·åŠ', rarity: 4 }
        };

        // ææ–™æ•¸æ“šåº«
        const materials = {
            skill: {
                forgery: { name: 'é›é‘„', tier: 1, type: 'skill' },
                wavewornResidue: { name: 'æµªç—•æ®˜éª¸', tier: 2, type: 'skill', synthesis: { forgery: 4 } },
                undulatedPearl: { name: 'è¿´æ—‹æ˜ç ', tier: 3, type: 'skill', synthesis: { wavewornResidue: 4 } },
                howlerCore: { name: 'å’†å“®æ ¸å¿ƒ', tier: 4, type: 'skill', synthesis: { undulatedPearl: 4 } },
                
                basicTacetCore: { name: 'åŸºç¤éŸ³éª¸æ ¸', tier: 1, type: 'monster' },
                mediumTacetCore: { name: 'ä¸­ç´šéŸ³éª¸æ ¸', tier: 2, type: 'monster', synthesis: { basicTacetCore: 4 } },
                advancedTacetCore: { name: 'é«˜ç´šéŸ³éª¸æ ¸', tier: 3, type: 'monster', synthesis: { mediumTacetCore: 4 } },
                premiumTacetCore: { name: 'é ‚ç´šéŸ³éª¸æ ¸', tier: 4, type: 'monster', synthesis: { advancedTacetCore: 4 } },
                
                bellBorneGeochelone: { name: 'éˆ´æ®¼é¾œææ–™', type: 'boss' },
                impermanenceHeron: { name: 'ç„¡å¸¸é³¶ææ–™', type: 'boss' },
                lampylumen: { name: 'è¼è¢ææ–™', type: 'boss' },
                
                thunderingMephis: { name: 'é›·é³´æ¢…è²æ–¯', type: 'weekly' },
                feilian: { name: 'é£›å»‰', type: 'weekly' },
                crownless: { name: 'ç„¡å† è€…', type: 'weekly' },
                jue: { name: 'è§’', type: 'weekly' }
            },
            weapon: {
                basicFeedstock: { name: 'åŸºç¤æ­¦å‚™', tier: 1, type: 'exp' },
                mediumFeedstock: { name: 'ä¸­ç´šæ­¦å‚™', tier: 2, type: 'exp' },
                advancedFeedstock: { name: 'é«˜ç´šæ­¦å‚™', tier: 3, type: 'exp' },
                premiumFeedstock: { name: 'é ‚ç´šæ­¦å‚™', tier: 4, type: 'exp' },
                
                inertMetallicDrip: { name: 'æƒ°æ€§é‡‘å±¬æ»´', tier: 1, type: 'ascension' },
                reactiveMetallicDrip: { name: 'åæ‡‰é‡‘å±¬æ»´', tier: 2, type: 'ascension', synthesis: { inertMetallicDrip: 4 } },
                polarizedMetallicDrip: { name: 'æ¥µåŒ–é‡‘å±¬æ»´', tier: 3, type: 'ascension', synthesis: { reactiveMetallicDrip: 4 } },
                heterizedMetallicDrip: { name: 'ç•°æ§‹é‡‘å±¬æ»´', tier: 4, type: 'ascension', synthesis: { polarizedMetallicDrip: 4 } },
                
                extractedPhlogiston: { name: 'æå–ç‡ƒç´ ', tier: 1, type: 'monster' },
                refinedPhlogiston: { name: 'ç²¾ç…‰ç‡ƒç´ ', tier: 2, type: 'monster', synthesis: { extractedPhlogiston: 4 } },
                flawlessPhlogiston: { name: 'ç„¡ç‘•ç‡ƒç´ ', tier: 3, type: 'monster', synthesis: { refinedPhlogiston: 4 } }
            },
            common: {
                shellCredit: { name: 'è²å¹£', type: 'currency' }
            }
        };

        // æŠ€èƒ½å‡ç´šææ–™éœ€æ±‚è¡¨
        const skillMaterialRequirements = {
            1: { forgery: 2500, basicTacetCore: 2 },
            2: { forgery: 5000, basicTacetCore: 3 },
            3: { forgery: 7500, mediumTacetCore: 2, bellBorneGeochelone: 1 },
            4: { forgery: 10000, mediumTacetCore: 3, bellBorneGeochelone: 1 },
            5: { forgery: 15000, advancedTacetCore: 2, bellBorneGeochelone: 1 },
            6: { forgery: 20000, advancedTacetCore: 3, bellBorneGeochelone: 1, thunderingMephis: 1 },
            7: { forgery: 30000, premiumTacetCore: 2, bellBorneGeochelone: 1, thunderingMephis: 1 },
            8: { forgery: 40000, premiumTacetCore: 3, bellBorneGeochelone: 1, thunderingMephis: 1 },
            9: { forgery: 50000, premiumTacetCore: 4, bellBorneGeochelone: 1, thunderingMephis: 1 }
        };

        // å‡ç´šè¨ˆåŠƒåˆ—è¡¨
        let upgradePlans = [];
        
        // æœ¬åœ°å­˜å„²
        let inventory = {};

        // åˆå§‹åŒ–
        function init() {
            loadInventory();
            loadPlans();
            renderInventoryGrids();
            populateCharacterSelect();
            populateLevelSelects();
            renderPlanList();
        }

        // å¡«å……è§’è‰²é¸æ“‡å™¨
        function populateCharacterSelect() {
            const select = document.getElementById('characterSelect');
            select.innerHTML = '<option value="">è«‹é¸æ“‡è§’è‰²</option>';
            
            const grouped = {
                '5æ˜Ÿè§’è‰² - ç†±ç†”': [],
                '5æ˜Ÿè§’è‰² - æ°£å‹•': [],
                '5æ˜Ÿè§’è‰² - å°é›»': [],
                '5æ˜Ÿè§’è‰² - å†·å‡': [],
                '5æ˜Ÿè§’è‰² - è¡å°„': [],
                '5æ˜Ÿè§’è‰² - æ¹®æ»…': [],
                '4æ˜Ÿè§’è‰²': []
            };

            for (const [id, char] of Object.entries(characters)) {
                if (char.rarity === 5) {
                    const group = `5æ˜Ÿè§’è‰² - ${char.attr}`;
                    if (grouped[group]) {
                        grouped[group].push({ id, char });
                    }
                } else {
                    grouped['4æ˜Ÿè§’è‰²'].push({ id, char });
                }
            }

            for (const [groupName, chars] of Object.entries(grouped)) {
                if (chars.length > 0) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = groupName;
                    chars.forEach(({ id, char }) => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = char.name;
                        optgroup.appendChild(option);
                    });
                    select.appendChild(optgroup);
                }
            }
        }

        // å¡«å……ç­‰ç´šé¸æ“‡å™¨
        function populateLevelSelects() {
            const skillLevels = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
            const weaponLevels = [1, 20, 40, 50, 60, 70, 80, 90];

            const currentSkill = document.getElementById('currentSkillLevel');
            const targetSkill = document.getElementById('targetSkillLevel');
            const currentWeapon = document.getElementById('currentWeaponLevel');
            const targetWeapon = document.getElementById('targetWeaponLevel');

            skillLevels.forEach(level => {
                currentSkill.innerHTML += `<option value="${level}">Lv.${level}</option>`;
                if (level > 1) {
                    targetSkill.innerHTML += `<option value="${level}" ${level === 10 ? 'selected' : ''}>Lv.${level}</option>`;
                }
            });

            weaponLevels.forEach(level => {
                currentWeapon.innerHTML += `<option value="${level}">Lv.${level}</option>`;
                if (level > 1) {
                    targetWeapon.innerHTML += `<option value="${level}" ${level === 90 ? 'selected' : ''}>Lv.${level}</option>`;
                }
            });
        }

        // åˆ‡æ›æ¨™ç±¤
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // æ·»åŠ æŠ€èƒ½å‡ç´šè¨ˆåŠƒ
        function addSkillPlan() {
            const charId = document.getElementById('characterSelect').value;
            if (!charId) {
                alert('è«‹é¸æ“‡è§’è‰²');
                return;
            }

            const char = characters[charId];
            const skillType = document.getElementById('skillType');
            const currentLevel = parseInt(document.getElementById('currentSkillLevel').value);
            const targetLevel = parseInt(document.getElementById('targetSkillLevel').value);

            if (targetLevel <= currentLevel) {
                alert('ç›®æ¨™ç­‰ç´šå¿…é ˆå¤§æ–¼ç•¶å‰ç­‰ç´š');
                return;
            }

            const plan = {
                id: Date.now(),
                type: 'skill',
                charId,
                charName: char.name,
                skillType: skillType.options[skillType.selectedIndex].text,
                currentLevel,
                targetLevel,
                materials: calculateSkillMaterials(currentLevel, targetLevel)
            };

            upgradePlans.push(plan);
            savePlans();
            renderPlanList();
            
            // åˆ‡æ›åˆ°ç¸½è¦½
            document.querySelector('.tab:nth-child(2)').click();
        }

        // æ·»åŠ æ­¦å™¨å‡ç´šè¨ˆåŠƒ
        function addWeaponPlan() {
            const weaponName = document.getElementById('weaponName').value || 'æœªå‘½åæ­¦å™¨';
            const rarity = parseInt(document.getElementById('weaponRarity').value);
            const weaponType = document.getElementById('weaponType');
            const currentLevel = parseInt(document.getElementById('currentWeaponLevel').value);
            const targetLevel = parseInt(document.getElementById('targetWeaponLevel').value);

            if (targetLevel <= currentLevel) {
                alert('ç›®æ¨™ç­‰ç´šå¿…é ˆå¤§æ–¼ç•¶å‰ç­‰ç´š');
                return;
            }

            const plan = {
                id: Date.now(),
                type: 'weapon',
                weaponName,
                rarity,
                weaponType: weaponType.options[weaponType.selectedIndex].text,
                currentLevel,
                targetLevel,
                materials: calculateWeaponMaterials(rarity, currentLevel, targetLevel)
            };

            upgradePlans.push(plan);
            savePlans();
            renderPlanList();
            
            // åˆ‡æ›åˆ°ç¸½è¦½
            document.querySelector('.tab:nth-child(2)').click();
        }

        // è¨ˆç®—æŠ€èƒ½ææ–™
        function calculateSkillMaterials(currentLevel, targetLevel) {
            const needed = {};

            for (let i = currentLevel; i < targetLevel; i++) {
                const requirements = skillMaterialRequirements[i];
                if (requirements) {
                    for (const [material, amount] of Object.entries(requirements)) {
                        needed[material] = (needed[material] || 0) + amount;
                    }
                }
            }

            return needed;
        }

        // è¨ˆç®—æ­¦å™¨ææ–™
        function calculateWeaponMaterials(rarity, currentLevel, targetLevel) {
            const needed = {};
            
            const expTable = {
                3: { 20: 15000, 40: 45000, 50: 75000, 60: 120000, 70: 180000, 80: 250000, 90: 340000 },
                4: { 20: 20000, 40: 60000, 50: 100000, 60: 160000, 70: 240000, 80: 330000, 90: 450000 },
                5: { 20: 25000, 40: 75000, 50: 125000, 60: 200000, 70: 300000, 80: 410000, 90: 560000 }
            };

            let totalExp = 0;
            const levels = [1, 20, 40, 50, 60, 70, 80, 90];
            
            for (let i = 0; i < levels.length - 1; i++) {
                if (currentLevel < levels[i + 1] && targetLevel > levels[i]) {
                    const levelKey = levels[i + 1];
                    totalExp += expTable[rarity][levelKey] || 0;
                }
            }

            needed.premiumFeedstock = Math.floor(totalExp / 10000);
            totalExp %= 10000;
            needed.advancedFeedstock = Math.floor(totalExp / 5000);
            totalExp %= 5000;
            needed.mediumFeedstock = Math.floor(totalExp / 2500);
            totalExp %= 2500;
            needed.basicFeedstock = Math.ceil(totalExp / 1000);

            const breakthroughLevels = [20, 40, 50, 60, 70, 80];
            let breakthroughs = 0;
            
            for (const level of breakthroughLevels) {
                if (currentLevel < level && targetLevel >= level) {
                    breakthroughs++;
                }
            }

            if (breakthroughs > 0) {
                needed.inertMetallicDrip = breakthroughs * 4;
                needed.reactiveMetallicDrip = breakthroughs * 3;
                needed.polarizedMetallicDrip = breakthroughs * 2;
                needed.heterizedMetallicDrip = breakthroughs * 1;
                needed.extractedPhlogiston = breakthroughs * 8;
                needed.refinedPhlogiston = breakthroughs * 6;
                needed.flawlessPhlogiston = breakthroughs * 4;
                needed.shellCredit = breakthroughs * 10000;
            }

            return needed;
        }

        // æ¸²æŸ“è¨ˆåŠƒåˆ—è¡¨
        function renderPlanList() {
            const listDiv = document.getElementById('planList');
            
            if (upgradePlans.length === 0) {
                listDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <h3>å°šæœªæ·»åŠ ä»»ä½•å‡ç´šè¨ˆåŠƒ</h3>
                        <p>è«‹åœ¨ä¸Šæ–¹é¸æ“‡è§’è‰²æŠ€èƒ½æˆ–æ­¦å™¨é€²è¡Œè¦åŠƒ</p>
                    </div>
                `;
                return;
            }

            let html = '';
            upgradePlans.forEach(plan => {
                if (plan.type === 'skill') {
                    const char = characters[plan.charId];
                    html += `
                        <div class="plan-item">
                            <div class="plan-header">
                                <div class="plan-title">
                                    <span class="attribute-badge attr-${char.attr.toLowerCase()}">${char.attr}</span>
                                    ${plan.charName} - ${plan.skillType}
                                </div>
                                <div class="plan-actions">
                                    <button onclick="removePlan(${plan.id})" class="btn-danger">åˆªé™¤</button>
                                </div>
                            </div>
                            <div class="plan-details">
                                ç­‰ç´šï¼šLv.${plan.currentLevel} â†’ Lv.${plan.targetLevel}
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="plan-item">
                            <div class="plan-header">
                                <div class="plan-title">
                                    <span class="attribute-badge" style="background: #f39c12; color: white;">${plan.rarity}â˜…</span>
                                    ${plan.weaponName} (${plan.weaponType})
                                </div>
                                <div class="plan-actions">
                                    <button onclick="removePlan(${plan.id})" class="btn-danger">åˆªé™¤</button>
                                </div>
                            </div>
                            <div class="plan-details">
                                ç­‰ç´šï¼šLv.${plan.currentLevel} â†’ Lv.${plan.targetLevel}
                            </div>
                        </div>
                    `;
                }
            });

            listDiv.innerHTML = html;
        }

        // ç§»é™¤è¨ˆåŠƒ
        function removePlan(planId) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¨ˆåŠƒå—ï¼Ÿ')) {
                upgradePlans = upgradePlans.filter(p => p.id !== planId);
                savePlans();
                renderPlanList();
            }
        }

        // æ¸…ç©ºæ‰€æœ‰è¨ˆåŠƒ
        function clearAllPlans() {
            if (confirm('âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å‡ç´šè¨ˆåŠƒå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                upgradePlans = [];
                savePlans();
                renderPlanList();
                document.getElementById('totalResults').style.display = 'none';
            }
        }

        // è¨ˆç®—ç¸½éœ€æ±‚
        function calculateTotal() {
            if (upgradePlans.length === 0) {
                alert('è«‹å…ˆæ·»åŠ å‡ç´šè¨ˆåŠƒ');
                return;
            }

            const totalNeeded = {};
            
            upgradePlans.forEach(plan => {
                for (const [material, amount] of Object.entries(plan.materials)) {
                    totalNeeded[material] = (totalNeeded[material] || 0) + amount;
                }
            });

            displayTotalResults(totalNeeded);
        }

        // é¡¯ç¤ºç¸½éœ€æ±‚çµæœ
        function displayTotalResults(needed) {
            const resultsDiv = document.getElementById('totalResults');
            const allMaterials = { ...materials.skill, ...materials.weapon, ...materials.common };
            
            let html = '<h3 class="section-title">ğŸ“Š ç¸½ææ–™éœ€æ±‚</h3>';
            html += `<p class="info-text">å·²è¦åŠƒ ${upgradePlans.length} å€‹å‡ç´šé …ç›®</p>`;

            const groupedMaterials = {};
            for (const [key, amount] of Object.entries(needed)) {
                const material = allMaterials[key];
                if (!material || amount === 0) continue;
                
                const type = material.type || 'other';
                if (!groupedMaterials[type]) {
                    groupedMaterials[type] = [];
                }
                groupedMaterials[type].push({ key, material, amount });
            }

            const typeNames = {
                'skill': 'ğŸ¯ æŠ€èƒ½ææ–™',
                'exp': 'ğŸ“ˆ ç¶“é©—ææ–™',
                'ascension': 'â¬†ï¸ çªç ´ææ–™',
                'monster': 'ğŸ‘¾ æ€ªç‰©æ‰è½',
                'boss': 'ğŸ‘¹ é¦–é ˜ææ–™',
                'weekly': 'â° é€±æœ¬ææ–™',
                'currency': 'ğŸ’° è²¨å¹£'
            };

            for (const [type, items] of Object.entries(groupedMaterials)) {
                html += `<div class="section-title">${typeNames[type] || 'å…¶ä»–ææ–™'}</div>`;
                
                for (const { key, material, amount } of items) {
                    const owned = inventory[key] || 0;
                    const shortage = amount - owned;
                    
                    html += `
                        <div class="material-item">
                            <span class="material-name">${material.name}</span>
                            <div class="material-count">
                                <span class="needed">éœ€è¦: ${amount.toLocaleString()}</span>
                                <span class="owned">æ“æœ‰: ${owned.toLocaleString()}</span>
                                ${shortage > 0 ? 
                                    `<span class="shortage">ç¼ºå°‘: ${shortage.toLocaleString()}</span>` : 
                                    `<span class="surplus">å¤šé¤˜: ${Math.abs(shortage).toLocaleString()}</span>`
                                }
                            </div>
                        </div>
                    `;

                    // è¨ˆç®—åˆæˆå»ºè­°
                    if (shortage > 0 && material.synthesis) {
                        const synthesisSteps = [];
                        for (const [sourceKey, ratio] of Object.entries(material.synthesis)) {
                            const sourceMaterial = allMaterials[sourceKey];
                            if (sourceMaterial) {
                                const neededAmount = shortage * ratio;
                                const sourceOwned = inventory[sourceKey] || 0;
                                const sourceShortage = Math.max(0, neededAmount - sourceOwned);
                                
                                if (sourceShortage === 0) {
                                    synthesisSteps.push(`âœ… å¯ç”¨ ${neededAmount} å€‹ ${sourceMaterial.name} åˆæˆ`);
                                } else {
                                    synthesisSteps.push(`âš ï¸ éœ€è¦ ${neededAmount} å€‹ ${sourceMaterial.name}ï¼ˆç¼º ${sourceShortage} å€‹ï¼‰`);
                                }
                            }
                        }
                        if (synthesisSteps.length > 0) {
                            html += `<div class="synthesis-info">ğŸ’¡ åˆæˆå»ºè­°: ${synthesisSteps.join(' | ')}</div>`;
                        }
                    }
                }
            }

            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        }

        // æ¸²æŸ“åº«å­˜ç¶²æ ¼
        function renderInventoryGrids() {
            renderInventoryGrid('skillInventoryGrid', materials.skill);
            renderInventoryGrid('weaponInventoryGrid', materials.weapon);
            renderInventoryGrid('commonInventoryGrid', materials.common);
        }

        function renderInventoryGrid(gridId, materialDB) {
            const grid = document.getElementById(gridId);
            let html = '';

            for (const [key, material] of Object.entries(materialDB)) {
                const value = inventory[key] || 0;
                html += `
                    <div class="inventory-item">
                        <label>${material.name}</label>
                        <input type="number" 
                               min="0" 
                               value="${value}" 
                               onchange="updateInventory('${key}', this.value)"
                               placeholder="0">
                    </div>
                `;
            }

            grid.innerHTML = html;
        }

        // æ›´æ–°åº«å­˜
        function updateInventory(key, value) {
            inventory[key] = parseInt(value) || 0;
        }

        // ä¿å­˜åº«å­˜
        function saveInventory() {
            localStorage.setItem('wuwa_inventory', JSON.stringify(inventory));
            alert('âœ… åº«å­˜å·²ä¿å­˜ï¼');
        }

        // è¼‰å…¥åº«å­˜
        function loadInventory() {
            const saved = localStorage.getItem('wuwa_inventory');
            if (saved) {
                try {
                    inventory = JSON.parse(saved);
                } catch (e) {
                    console.error('è¼‰å…¥åº«å­˜å¤±æ•—', e);
                    inventory = {};
                }
            }
        }

        // æ¸…ç©ºåº«å­˜
        function clearInventory() {
            if (confirm('âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰åº«å­˜è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                inventory = {};
                localStorage.removeItem('wuwa_inventory');
                renderInventoryGrids();
                alert('âœ… åº«å­˜å·²æ¸…ç©ºï¼');
            }
        }

        // ä¿å­˜è¨ˆåŠƒ
        function savePlans() {
            localStorage.setItem('wuwa_plans', JSON.stringify(upgradePlans));
        }

        // è¼‰å…¥è¨ˆåŠƒ
        function loadPlans() {
            const saved = localStorage.getItem('wuwa_plans');
            if (saved) {
                try {
                    upgradePlans = JSON.parse(saved);
                } catch (e) {
                    console.error('è¼‰å…¥è¨ˆåŠƒå¤±æ•—', e);
                    upgradePlans = [];
                }
            }
        }

        // æ›´æ–°è§’è‰²è³‡æ–™
        async function refreshData() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = 'ğŸ”„ æ›´æ–°ä¸­...';
            
            try {
                // æ¨¡æ“¬APIèª¿ç”¨ï¼ˆå¯¦éš›ä¸Šæ‡‰è©²å¾APIç²å–ï¼‰
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // é€™è£¡å¯ä»¥æ·»åŠ å¯¦éš›çš„APIèª¿ç”¨
                // const response = await fetch('API_URL');
                // const data = await response.json();
                // characters = data.characters;
                
                populateCharacterSelect();
                alert('âœ… è§’è‰²è³‡æ–™å·²æ›´æ–°ï¼');
            } catch (error) {
                alert('âŒ æ›´æ–°å¤±æ•—ï¼š' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ”„ æ›´æ–°è§’è‰²è³‡æ–™';
            }
        }

        // åŒ¯å‡ºè³‡æ–™
        function exportData() {
            const data = {
                version: '1.0',
                inventory,
                plans: upgradePlans,
                exportTime: new Date().toISOString()
            };
            
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `wuwa_data_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // åŒ¯å…¥è³‡æ–™
        function importData() {
            document.getElementById('importModal').classList.add('active');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
            document.getElementById('importData').value = '';
        }

        function confirmImport() {
            const jsonText = document.getElementById('importData').value.trim();
            if (!jsonText) {
                alert('è«‹è¼¸å…¥è³‡æ–™');
                return;
            }

            try {
                const data = JSON.parse(jsonText);
                
                if (data.inventory) {
                    inventory = data.inventory;
                    localStorage.setItem('wuwa_inventory', JSON.stringify(inventory));
                }
                
                if (data.plans) {
                    upgradePlans = data.plans;
                    localStorage.setItem('wuwa_plans', JSON.stringify(upgradePlans));
                }
                
                renderInventoryGrids();
                renderPlanList();
                closeImportModal();
                alert('âœ… è³‡æ–™åŒ¯å…¥æˆåŠŸï¼');
            } catch (error) {
                alert('âŒ åŒ¯å…¥å¤±æ•—ï¼šè³‡æ–™æ ¼å¼éŒ¯èª¤');
            }
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>